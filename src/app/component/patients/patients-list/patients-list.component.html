<div class="patient-list-container">
  <div class="patient-list-header">
    <h2 class="patient-list-title">Patient List</h2>
    <button mat-raised-button color="primary" (click)="navigateToPatientForm()" class="action-button">Add New Patient</button>
  </div>

  <div class="filter-section">
    <mat-form-field appearance="outline">
      <mat-label>Filter</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Filter patients...">
    </mat-form-field>
  </div>

  <div class="mat-elevation-z8">
    <mat-table [dataSource]="dataSource" matSort>
      
      <ng-container matColumnDef="patientId">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Patient ID </th>
        <td mat-cell *matCellDef="let row"> {{row.patientId}} </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
        <td mat-cell *matCellDef="let row"> {{row.name}} </td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
        <td mat-cell *matCellDef="let row"> {{row.email}} </td>
      </ng-container>

      <ng-container matColumnDef="gender">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Gender </th>
        <td mat-cell *matCellDef="let row"> {{row.gender}} </td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Phone </th>
        <td mat-cell *matCellDef="let row"> {{row.phone}} </td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Age </th>
        <td mat-cell *matCellDef="let row"> {{row.age}} </td>
      </ng-container>

      <ng-container matColumnDef="dateJoined">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Date Joined </th>
        <td mat-cell *matCellDef="let row"> {{row.dateJoined}} </td>
      </ng-container>

      <ng-container matColumnDef="CIN">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> CIN </th>
        <td mat-cell *matCellDef="let row"> {{row.CIN}} </td>
      </ng-container>

      <ng-container matColumnDef="disease">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Disease </th>
        <td mat-cell *matCellDef="let row"> {{row.disease}} </td>
      </ng-container>

      <ng-container matColumnDef="documents">
        <th mat-header-cell *matHeaderCellDef> Documents </th>
        <td mat-cell *matCellDef="let row"> {{row.documents ? row.documents.length : 0}} </td>
      </ng-container>

      <ng-container matColumnDef="insurance">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Insurance </th>
        <td mat-cell *matCellDef="let row"> {{row.insurance}} </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
        <td mat-cell *matCellDef="let row" class="status-cell">
          <span class="status-dot" [ngClass]="{'status-active': row.status === 'active',
                                           'status-inactive': row.status === 'inactive',
                                           'status-pending': row.status === 'pending'}"></span>
          {{row.status}}
        </td>
      </ng-container>

      <ng-container matColumnDef="medicalHistory">
        <th mat-header-cell *matHeaderCellDef> Medical History </th>
        <td mat-cell *matCellDef="let row"> {{row.medicalHistory ? row.medicalHistory.length : 0}} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let row">
          <button mat-raised-button color="primary" (click)="viewPatientDetails(row.patientId)" class="action-button">View</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['patientId', 'name', 'email', 'gender', 'phone', 'age', 'dateJoined', 'CIN', 'disease', 'documents', 'insurance', 'status', 'medicalHistory', 'actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['patientId', 'name', 'email', 'gender', 'phone', 'age', 'dateJoined', 'CIN', 'disease', 'documents', 'insurance', 'status', 'medicalHistory', 'actions'];"></tr>
    </mat-table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
  </div>

  <div *ngIf="!loading && !error && patients.length === 0" class="empty-state">
    <mat-icon class="empty-state-icon">person_off</mat-icon>
    <p>No patients found</p>
  </div>
</div>